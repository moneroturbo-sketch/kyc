import{c as z,b as G,d as $,r as a,j as e}from"./index-Duky1hw0.js";import{u as m}from"./useMutation-DKaRXdjm.js";import{C as Q,b as X,c as Z,d as ee,a as se}from"./card-B_NDjbCe.js";import{B as d}from"./button-YYpB0I7v.js";import{I as r}from"./input-Cs71ZbM6.js";import{L as o}from"./label-C1MqlX-q.js";import{T as te,a as ae,b as U,c as A}from"./tabs-Bi9jMGms.js";import{D as re,d as oe,a as ie,b as ne,c as de}from"./dialog-Dg6_M2uS.js";import{u as le}from"./useTranslation-BAWnTwKQ.js";import{S as ce}from"./shield-BKxAL8Uz.js";import{U as I}from"./Combination-DHSAZB90.js";import{L as V}from"./lock-DfqZZ0Uz.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ue=z("mail",me);function ke(){const{t:ge}=le(),[,F]=G(),{toast:i}=$(),[c,u]=a.useState({username:"",email:"",password:"",twoFactorToken:""}),[l,h]=a.useState({username:"",email:"",password:""}),[x,J]=a.useState(""),[f,g]=a.useState("email"),[B,Y]=a.useState(!1),[H,K]=a.useState(!1),[w,E]=a.useState(""),[P,T]=a.useState(!1),[W,L]=a.useState("email"),[j,O]=a.useState(""),[b,R]=a.useState(""),[p,q]=a.useState(""),[v,D]=a.useState(""),[_,M]=a.useState(!1),N=m({mutationFn:async s=>{const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s.username||void 0,email:s.email||void 0,password:s.password,twoFactorToken:s.twoFactorToken,emailVerificationCode:s.emailVerificationCode})}),n=await t.json();if(!t.ok)throw new Error(n.message);return n},onSuccess:s=>{if(s.requiresTwoFactor){Y(!0),K(s.canUseEmailCode||!1),i({title:"2FA Required",description:s.canUseEmailCode?"Use authenticator code or email code if you lost your device":"Please enter your authenticator code"});return}localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),i({title:"Welcome back!",description:`Logged in as ${s.user.username}`}),F("/")},onError:s=>{i({variant:"destructive",title:"Login Failed",description:s.message})}}),y=m({mutationFn:async s=>{const t=await fetch("/api/auth/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),n=await t.json();if(!t.ok)throw new Error(n.message);return n},onSuccess:()=>{i({title:"Code Sent",description:"Check your email for the verification code"}),g("verify")},onError:s=>{i({variant:"destructive",title:"Failed",description:s.message})}}),C=m({mutationFn:async s=>{const t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await t.json();if(!t.ok)throw new Error(n.message);return n},onSuccess:s=>{localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),i({title:"Account Created!",description:"Welcome to KYC Marketplace"}),F("/")},onError:s=>{i({variant:"destructive",title:"Registration Failed",description:s.message})}}),S=m({mutationFn:async s=>{const t=await fetch("/api/auth/request-password-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),n=await t.json();if(!t.ok)throw new Error(n.message);return n},onSuccess:()=>{i({title:"Check Email",description:"Password reset code sent to your email"}),L("reset")},onError:s=>{i({variant:"destructive",title:"Failed",description:s.message})}}),k=m({mutationFn:async()=>{if(p!==v)throw new Error("Passwords do not match");const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b,newPassword:p})}),t=await s.json();if(!s.ok)throw new Error(t.message);return t},onSuccess:()=>{i({title:"Success!",description:"Password reset successfully. You can now login."}),M(!1),L("email"),O(""),R(""),q(""),D("")},onError:s=>{i({variant:"destructive",title:"Failed",description:s.message})}});return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-3 sm:p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-primary rounded-xl",children:e.jsx(ce,{className:"h-7 sm:h-8 w-7 sm:w-8 text-primary-foreground"})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:"KYC Marketplace"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-2",children:"Secure peer-to-peer trading"})]}),e.jsxs(Q,{className:"border-border bg-card/50 backdrop-blur",children:[e.jsxs(X,{children:[e.jsx(Z,{className:"text-foreground",children:"Get Started"}),e.jsx(ee,{children:"Sign in or create an account to start trading"})]}),e.jsx(se,{children:e.jsxs(te,{defaultValue:"login",children:[e.jsxs(ae,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(U,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(U,{value:"register","data-testid":"tab-register",children:"Register"})]}),e.jsx(A,{value:"login",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault();const t={...c};P&&w&&(t.emailVerificationCode=w,t.twoFactorToken=""),N.mutate(t)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-identifier",className:"text-foreground",children:"Username or Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(r,{id:"login-identifier","data-testid":"input-login-identifier",placeholder:"Enter username or email",className:"pl-10 bg-muted border-border text-foreground",value:c.username,onChange:s=>{const t=s.target.value;u({...c,username:t.includes("@")?"":t,email:t.includes("@")?t:""})}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(r,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:"Enter password",className:"pl-10 bg-muted border-border text-foreground",value:c.password,onChange:s=>u({...c,password:s.target.value})})]})]}),B&&e.jsx("div",{className:"space-y-3",children:P?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email-code",className:"text-foreground",children:"Email Code"}),e.jsx(r,{id:"email-code","data-testid":"input-email-code",placeholder:"Enter code from email",className:"bg-muted border-border text-foreground",value:w,onChange:s=>E(s.target.value)})]}),e.jsx(d,{type:"button",variant:"outline",className:"w-full text-sm",onClick:()=>{T(!1),E("")},"data-testid":"button-back-to-authenticator",children:"Back to authenticator code"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"2fa-token",className:"text-foreground",children:"Authenticator Code"}),e.jsx(r,{id:"2fa-token","data-testid":"input-2fa-token",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:c.twoFactorToken,onChange:s=>u({...c,twoFactorToken:s.target.value})})]}),H&&e.jsx(d,{type:"button",variant:"outline",className:"w-full text-sm",onClick:()=>{T(!0),u({...c,twoFactorToken:""})},"data-testid":"button-use-email-code",children:"Lost your authenticator? Use email code instead"})]})}),e.jsx(d,{type:"submit","data-testid":"button-login",className:"w-full",disabled:N.isPending,children:N.isPending?"Signing in...":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsxs(re,{open:_,onOpenChange:M,children:[e.jsx(oe,{asChild:!0,children:e.jsx(d,{variant:"link",className:"text-sm p-0","data-testid":"button-forgot-password",children:"Forgot Password?"})}),e.jsxs(ie,{className:"max-w-md",children:[e.jsx(ne,{children:e.jsx(de,{className:"text-foreground",children:"Reset Password"})}),W==="email"?e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email address and we'll send you a code to reset your password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"forgot-email",className:"text-foreground",children:"Email Address"}),e.jsx(r,{id:"forgot-email",type:"email",placeholder:"Enter your email",className:"bg-muted border-border",value:j,onChange:s=>O(s.target.value),"data-testid":"input-forgot-password-email"})]}),e.jsx(d,{className:"w-full",onClick:()=>S.mutate(j),disabled:!j||S.isPending,"data-testid":"button-send-reset-code",children:S.isPending?"Sending...":"Send Reset Code"})]}):e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the reset code from your email and your new password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reset-code",className:"text-foreground",children:"Reset Code"}),e.jsx(r,{id:"reset-code",placeholder:"Enter reset code",className:"bg-muted border-border",value:b,onChange:s=>R(s.target.value),"data-testid":"input-reset-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"new-pwd",className:"text-foreground",children:"New Password"}),e.jsx(r,{id:"new-pwd",type:"password",placeholder:"Enter new password",className:"bg-muted border-border",value:p,onChange:s=>q(s.target.value),"data-testid":"input-reset-new-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirm-pwd",className:"text-foreground",children:"Confirm Password"}),e.jsx(r,{id:"confirm-pwd",type:"password",placeholder:"Confirm new password",className:"bg-muted border-border",value:v,onChange:s=>D(s.target.value),"data-testid":"input-reset-confirm-password"})]}),e.jsx(d,{className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>k.mutate(),disabled:!b||!p||!v||k.isPending,"data-testid":"button-confirm-reset-password",children:k.isPending?"Resetting...":"Reset Password"})]})]})]})})]})}),e.jsxs(A,{value:"register",children:[f==="email"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y.mutate(l.email)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(r,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"Enter your email",className:"pl-10 bg-muted border-border text-foreground",value:l.email,onChange:s=>h({...l,email:s.target.value}),required:!0})]})]}),e.jsx(d,{type:"submit","data-testid":"button-send-code",className:"w-full",disabled:y.isPending,children:y.isPending?"Sending...":"Send Verification Code"})]}),f==="verify"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),g("create")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-foreground",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the code sent to ",l.email]}),e.jsx("div",{className:"relative",children:e.jsx(r,{"data-testid":"input-verification-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:x,onChange:s=>J(s.target.value.replace(/\D/g,"").slice(0,6)),required:!0})})]}),e.jsx(d,{type:"submit","data-testid":"button-verify-code",className:"w-full",disabled:x.length!==6,children:"Continue"}),e.jsx(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>g("email"),children:"Back"})]}),f==="create"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),C.mutate({...l,verificationCode:x})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(r,{id:"register-username","data-testid":"input-register-username",placeholder:"Choose username",className:"pl-10 bg-muted border-border text-foreground",value:l.username,onChange:s=>h({...l,username:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(r,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Create password",className:"pl-10 bg-muted border-border text-foreground",value:l.password,onChange:s=>h({...l,password:s.target.value}),required:!0})]})]}),e.jsx(d,{type:"submit","data-testid":"button-register",className:"w-full",disabled:C.isPending,children:C.isPending?"Creating account...":"Create Account"}),e.jsx(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>g("verify"),children:"Back"})]})]})]})})]})]})})}export{ke as default};
