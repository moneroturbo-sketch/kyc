import{c as O,d as oe,u as de,g as le,r as i,a as C,j as e,S as ce,f as l,m as H}from"./index-D845fdug.js";import{u as j}from"./useMutation-DT-TI1wF.js";import{L as me}from"./Layout-DxIQFL4N.js";import{C as F,b as S,c as T,a as P,d as V}from"./card-DpHyXwy-.js";import{B as c}from"./button-D1bqphx3.js";import{I as E}from"./input-Bxur_fWW.js";import{L as m}from"./label-ztfKelLY.js";import{B as G}from"./badge-BnHpXqJb.js";import{D as J,d as ue,a as z,b as W,c as X}from"./dialog-AY1tb3Cj.js";import{S as xe,a as pe,b as he,c as fe,d as I}from"./select-xuAsf7uq.js";import{S as ge}from"./scroll-area-BARHoFGz.js";import{u as je}from"./useTranslation-BVrykDVu.js";import{U as ye}from"./index-CoW_blCo.js";import{C as K}from"./circle-check-big-RWOW0aXB.js";import{C as Z}from"./circle-alert-DEgQemF3.js";import{S as be}from"./shield-COkKzSXe.js";import{C as Ne}from"./copy-_IYpaRXi.js";import{K as ve}from"./key-DzAyf7YL.js";import{F as we}from"./file-text-CijsapEn.js";import{S as ke}from"./star-B29c5lBo.js";import"./ThemeToggle-C3xqmPyZ.js";import"./shopping-cart-CM3xDTpA.js";import"./triangle-alert-Cvu15Yci.js";import"./index-BdQq_4o_.js";import"./index-BKChnHnK.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],B=O("camera",Ce);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Se=O("smartphone",Fe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Pe=O("upload",Te);function ts(){const{t:s}=je(),{toast:n}=oe(),y=de(),o=le(),[ee,M]=i.useState(!1),[D,R]=i.useState(""),[se,b]=i.useState(!1),[$,te]=i.useState("passport"),[N,L]=i.useState(""),[u,U]=i.useState(null),[x,_]=i.useState(null),v=i.useRef(null),w=i.useRef(null),k=i.useRef(null),[De,Q]=i.useState(null),{data:d,isLoading:re}=C({queryKey:["me"],queryFn:async()=>(await l("/api/auth/me")).json()}),{data:p}=C({queryKey:["kyc-status"],queryFn:async()=>(await l("/api/kyc/status")).json()}),{data:a}=C({queryKey:["user-trades",o?.id],queryFn:async()=>{if(!o?.id)return null;const t=await l(`/api/users/${o.id}/trades`);if(!t.ok)throw new Error("Failed to fetch trades");return t.json()},enabled:!!o?.id}),{data:ae}=C({queryKey:["user-profile",o?.id],queryFn:async()=>{if(!o?.id)return null;const t=await l(`/api/users/${o.id}/profile`);if(!t.ok)throw new Error("Failed to fetch profile");return t.json()},enabled:!!o?.id}),h=j({mutationFn:async()=>{const t=await l("/api/auth/2fa/setup",{method:"POST"});if(!t.ok)throw new Error("Failed to setup 2FA");return t.json()}}),A=j({mutationFn:async t=>{const r=await l("/api/auth/2fa/enable",{method:"POST",body:JSON.stringify({token:t})});if(!r.ok)throw new Error("Invalid token");return r.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["me"]}),M(!1),R(""),n({title:"2FA Enabled",description:"Your account is now more secure"})},onError:()=>{n({variant:"destructive",title:"Invalid code",description:"Please try again"})}});j({mutationFn:async t=>{const r=await l("/api/auth/2fa/disable",{method:"POST",body:JSON.stringify({token:t})});if(!r.ok)throw new Error("Invalid token");return r.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["me"]}),n({title:"2FA Disabled"})},onError:()=>{n({variant:"destructive",title:"Invalid code"})}});const Y=j({mutationFn:async t=>{const r=new FormData;r.append("profilePicture",t);const f=H(),g=await fetch("/api/users/profile-picture",{method:"POST",headers:{Authorization:`Bearer ${f}`},body:r});if(!g.ok){const ne=await g.json();throw new Error(ne.message||"Failed to upload profile picture")}return g.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["me"]}),Q(null),k.current&&(k.current.value=""),n({title:"Profile Picture Updated",description:"Your profile picture has been updated"})},onError:t=>{n({variant:"destructive",title:"Upload Failed",description:t.message})}}),ie=t=>{const r=t.target.files?.[0];r&&(Q(r),Y.mutate(r))},q=j({mutationFn:async()=>{if(!u||!x||!N)throw new Error("Please fill in all required fields");const t=new FormData;t.append("idType",$),t.append("idNumber",N),t.append("idDocument",u),t.append("selfie",x);const r=H(),f=await fetch("/api/kyc/submit",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t});if(!f.ok){const g=await f.json();throw new Error(g.message||"Failed to submit KYC")}return f.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["kyc-status"]}),b(!1),L(""),U(null),_(null),v.current&&(v.current.value=""),w.current&&(w.current.value=""),n({title:"KYC Submitted",description:"Your documents are being reviewed"})},onError:t=>{n({variant:"destructive",title:"Submission Failed",description:t.message})}});return e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 max-w-3xl mx-auto px-2 sm:px-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:s("settings.title")}),e.jsxs(F,{children:[e.jsx(S,{children:e.jsxs(T,{className:"text-foreground flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),s("settings.account")]})}),e.jsx(P,{className:"space-y-4",children:re?e.jsx(ce,{className:"h-32"}):e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:k,accept:"image/*",className:"hidden",onChange:ie}),e.jsxs("div",{onClick:()=>k.current?.click(),className:"cursor-pointer group relative","data-testid":"upload-profile-picture",children:[d?.profilePicture?e.jsx("img",{src:d.profilePicture,alt:d.username,className:"w-20 h-20 rounded-full object-cover border-2 border-primary"}):e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-primary to-primary/60 rounded-full flex items-center justify-center text-primary-foreground text-2xl font-bold",children:d?.username?.[0]?.toUpperCase()}),e.jsx("div",{className:"absolute inset-0 bg-black/30 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(B,{className:"h-6 w-6 text-white"})}),Y.isPending&&e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-white border-t-transparent rounded-full"})})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-foreground font-medium text-lg",children:d?.username}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s("common.edit")}),e.jsx(G,{className:"mt-2",children:d?.role})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:s("auth.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-foreground font-medium",children:d?.email}),d?.emailVerified?e.jsx(K,{className:"h-4 w-4 text-green-500"}):e.jsx(Z,{className:"h-4 w-4 text-yellow-500"})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:s("common.confirm")}),e.jsx("p",{className:"text-foreground font-medium",children:new Date(d?.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(F,{children:[e.jsxs(S,{children:[e.jsxs(T,{className:"text-foreground flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),s("settings.security")]}),e.jsx(V,{children:s("settings.twoFactor")})]}),e.jsx(P,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Se,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:s("twoFactor.title")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s("twoFactor.description")})]})]}),d?.twoFactorEnabled?e.jsx(G,{className:"bg-green-600",children:s("twoFactor.enabled")}):e.jsxs(J,{open:ee,onOpenChange:M,children:[e.jsx(ue,{asChild:!0,children:e.jsx(c,{className:"bg-primary hover:bg-primary/90",onClick:()=>h.mutate(),"data-testid":"button-setup-2fa",children:s("twoFactor.enable")})}),e.jsxs(z,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(X,{className:"text-foreground",children:s("twoFactor.setup")})}),h.data?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s("twoFactor.scanQR")}),e.jsx("div",{className:"flex justify-center p-4 bg-white rounded-lg",children:e.jsx("img",{src:h.data.qrCode,alt:"QR Code",className:"w-48 h-48"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:s("twoFactor.enterManually")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{readOnly:!0,value:h.data.secret,className:"bg-muted border-border font-mono text-sm"}),e.jsx(c,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(h.data.secret),n({title:"Copied!"})},children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:s("twoFactor.verificationCode")}),e.jsx(E,{placeholder:"000000",maxLength:6,className:"bg-muted border-border text-center text-lg tracking-widest",value:D,onChange:t=>R(t.target.value),"data-testid":"input-2fa-verify"})]}),e.jsx(c,{className:"w-full bg-green-600 hover:bg-green-700",disabled:D.length!==6||A.isPending,onClick:()=>A.mutate(D),"data-testid":"button-verify-2fa",children:A.isPending?s("twoFactor.verifying"):s("twoFactor.verify")})]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:s("twoFactor.setuping")})]})]})]})]})})]}),o?.role!=="admin"&&o?.role!=="dispute_admin"&&e.jsxs(F,{children:[e.jsxs(S,{children:[e.jsxs(T,{className:"text-foreground flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),s("kyc.title")]}),e.jsx(V,{children:s("kyc.description")})]}),e.jsx(P,{children:e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[p?.status==="approved"?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"h-6 w-6 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:s("kyc.verified")}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:[s("kyc.tier"),": ",p.tier]})]})]}):p?.status==="pending"?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-yellow-500 border-t-transparent rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:s("kyc.pending")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s("kyc.pendingDesc")})]})]}):p?.status==="rejected"?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-6 w-6 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:s("kyc.rejected")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:p.rejectionReason||s("common.cancel")})]})]}),e.jsx(c,{className:"bg-primary hover:bg-primary/90",onClick:()=>b(!0),"data-testid":"button-resubmit-kyc",children:s("kyc.resubmit")})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:s("kyc.notVerified")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s("kyc.completeKyc")})]}),e.jsx(c,{className:"bg-primary hover:bg-primary/90",onClick:()=>b(!0),"data-testid":"button-start-kyc",children:s("kyc.startVerification")})]}),e.jsx(J,{open:se,onOpenChange:b,children:e.jsxs(z,{className:"max-w-md max-h-[90vh]",children:[e.jsx(W,{children:e.jsx(X,{className:"text-foreground",children:s("kyc.kycVerification")})}),e.jsx(ge,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:s("kyc.idType")}),e.jsxs(xe,{value:$,onValueChange:te,children:[e.jsx(pe,{className:"bg-muted border-border","data-testid":"select-id-type",children:e.jsx(he,{})}),e.jsxs(fe,{children:[e.jsx(I,{value:"passport",children:s("kyc.passport")}),e.jsx(I,{value:"national_id",children:s("kyc.nationalId")}),e.jsx(I,{value:"drivers_license",children:s("kyc.driversLicense")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:s("kyc.idNumber")}),e.jsx(E,{placeholder:s("kyc.enterIdNumber"),value:N,onChange:t=>L(t.target.value),className:"bg-muted border-border","data-testid":"input-id-number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:s("kyc.idDocument")}),e.jsx("input",{type:"file",ref:v,accept:"image/*,.pdf",className:"hidden",onChange:t=>U(t.target.files?.[0]||null)}),e.jsx("div",{onClick:()=>v.current?.click(),className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-primary transition-colors","data-testid":"upload-id-document",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-500",children:[e.jsx(we,{className:"h-5 w-5"}),e.jsx("span",{children:u.name})]}):e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx(Pe,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:"Click to upload ID document"}),e.jsx("p",{className:"text-xs",children:"JPG, PNG or PDF (max 5MB)"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-foreground",children:"Selfie with ID"}),e.jsx("input",{type:"file",ref:w,accept:"image/*",className:"hidden",onChange:t=>_(t.target.files?.[0]||null)}),e.jsx("div",{onClick:()=>w.current?.click(),className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-primary transition-colors","data-testid":"upload-selfie",children:x?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-500",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{children:x.name})]}):e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx(B,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:"Click to upload selfie holding your ID"}),e.jsx("p",{className:"text-xs",children:"JPG or PNG (max 5MB)"})]})})]}),e.jsx(c,{className:"w-full bg-primary hover:bg-primary/90",disabled:!u||!x||!N||q.isPending,onClick:()=>q.mutate(),"data-testid":"button-submit-kyc",children:q.isPending?"Submitting...":"Submit Verification"})]})})]})})]})})]}),a&&e.jsxs(F,{className:"bg-card border-border border-yellow-200 bg-yellow-50/20",children:[e.jsxs(S,{children:[e.jsxs(T,{className:"flex items-center gap-2 text-base",children:[e.jsx(ke,{className:"h-5 w-5 text-yellow-600"}),"Verified Badge Application"]}),e.jsx(V,{children:"Unlock the verified badge for increased trust and visibility"})]}),e.jsx(P,{className:"space-y-4",children:ae?.hasVerifyBadge?e.jsxs("div",{className:"text-center py-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(K,{className:"h-6 w-6 text-green-600"}),e.jsx("p",{className:"font-bold text-green-700",children:"You have the Verified Badge! ðŸŽ‰"})]}),e.jsx("p",{className:"text-sm text-green-600",children:"Your badge appears next to your name on your profile"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Requirements to qualify:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${a.totalTrades>=10?"bg-green-100/30 border border-green-200":"bg-gray-100/30 border border-gray-200"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold ${a.totalTrades>=10?"bg-green-600 text-white":"border-2 border-gray-400 text-gray-400"}`,children:a.totalTrades>=10?"âœ“":""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:a.totalTrades>=10?"text-green-700 font-medium":"text-muted-foreground",children:"More than 10 trades"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",a.totalTrades," trades"]})]})]}),e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${parseFloat(a.totalTradeVolume||"0")>700?"bg-green-100/30 border border-green-200":"bg-gray-100/30 border border-gray-200"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold ${parseFloat(a.totalTradeVolume||"0")>700?"bg-green-600 text-white":"border-2 border-gray-400 text-gray-400"}`,children:parseFloat(a.totalTradeVolume||"0")>700?"âœ“":""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:parseFloat(a.totalTradeVolume||"0")>700?"text-green-700 font-medium":"text-muted-foreground",children:"Trade volume above 700 USDT"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: $",a.totalTradeVolume||"0"]})]})]})]})]}),e.jsx(c,{disabled:a.totalTrades<10||parseFloat(a.totalTradeVolume||"0")<=700,className:"w-full bg-yellow-600 hover:bg-yellow-700","data-testid":"button-apply-verify-badge",onClick:()=>{console.log("Applying for verify badge"),n({title:"Application submitted",description:"Admin will review and approve your application soon"})},children:"Apply for Verified Badge"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Admin approval required â€¢ Badge appears next to your username once approved"})]})})]})]})})}export{ts as default};
