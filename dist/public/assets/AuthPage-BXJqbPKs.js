import{c as T,b as E,d as L,r as c,j as e}from"./index-D845fdug.js";import{u as b}from"./useMutation-DT-TI1wF.js";import{C as P,b as q,c as A,d as I,a as O}from"./card-DpHyXwy-.js";import{B as l}from"./button-D1bqphx3.js";import{I as n}from"./input-Bxur_fWW.js";import{L as d}from"./label-ztfKelLY.js";import{T as M,a as R,b as N,c as w}from"./tabs-Bo4khqKQ.js";import{u as D}from"./useTranslation-BVrykDVu.js";import{S as J}from"./shield-COkKzSXe.js";import{U as y}from"./index-CoW_blCo.js";import{L as S}from"./lock-D3xNgIaU.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],B=T("mail",V);function ee(){const{t:U}=D(),[,v]=E(),{toast:i}=L(),[o,u]=c.useState({username:"",password:"",twoFactorToken:""}),[s,g]=c.useState({username:"",email:"",password:""}),[p,C]=c.useState(""),[x,m]=c.useState("email"),[k,F]=c.useState(!1),h=b({mutationFn:async t=>{const r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw new Error(a.message);return a},onSuccess:t=>{if(t.requiresTwoFactor){F(!0),i({title:"2FA Required",description:"Please enter your authenticator code"});return}localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),i({title:"Welcome back!",description:`Logged in as ${t.user.username}`}),v("/")},onError:t=>{i({variant:"destructive",title:"Login Failed",description:t.message})}}),f=b({mutationFn:async t=>{const r=await fetch("/api/auth/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),a=await r.json();if(!r.ok)throw new Error(a.message);return a},onSuccess:()=>{i({title:"Code Sent",description:"Check your email for the verification code"}),m("verify")},onError:t=>{i({variant:"destructive",title:"Failed",description:t.message})}}),j=b({mutationFn:async t=>{const r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw new Error(a.message);return a},onSuccess:t=>{localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),i({title:"Account Created!",description:"Welcome to KYC Marketplace"}),v("/")},onError:t=>{i({variant:"destructive",title:"Registration Failed",description:t.message})}});return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-3 sm:p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-primary rounded-xl",children:e.jsx(J,{className:"h-7 sm:h-8 w-7 sm:w-8 text-primary-foreground"})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:"KYC Marketplace"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-2",children:"Secure peer-to-peer trading"})]}),e.jsxs(P,{className:"border-border bg-card/50 backdrop-blur",children:[e.jsxs(q,{children:[e.jsx(A,{className:"text-foreground",children:"Get Started"}),e.jsx(I,{children:"Sign in or create an account to start trading"})]}),e.jsx(O,{children:e.jsxs(M,{defaultValue:"login",children:[e.jsxs(R,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(N,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(N,{value:"register","data-testid":"tab-register",children:"Register"})]}),e.jsx(w,{value:"login",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),h.mutate(o)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"login-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(n,{id:"login-username","data-testid":"input-login-username",placeholder:"Enter username",className:"pl-10 bg-muted border-border text-foreground",value:o.username,onChange:t=>u({...o,username:t.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"login-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(n,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:"Enter password",className:"pl-10 bg-muted border-border text-foreground",value:o.password,onChange:t=>u({...o,password:t.target.value})})]})]}),k&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"2fa-token",className:"text-foreground",children:"2FA Code"}),e.jsx(n,{id:"2fa-token","data-testid":"input-2fa-token",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:o.twoFactorToken,onChange:t=>u({...o,twoFactorToken:t.target.value})})]}),e.jsx(l,{type:"submit","data-testid":"button-login",className:"w-full",disabled:h.isPending,children:h.isPending?"Signing in...":"Sign In"})]})}),e.jsxs(w,{value:"register",children:[x==="email"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),f.mutate(s.email)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(n,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"Enter your email",className:"pl-10 bg-muted border-border text-foreground",value:s.email,onChange:t=>g({...s,email:t.target.value}),required:!0})]})]}),e.jsx(l,{type:"submit","data-testid":"button-send-code",className:"w-full",disabled:f.isPending,children:f.isPending?"Sending...":"Send Verification Code"})]}),x==="verify"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),m("create")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-foreground",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the code sent to ",s.email]}),e.jsx("div",{className:"relative",children:e.jsx(n,{"data-testid":"input-verification-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:p,onChange:t=>C(t.target.value.replace(/\D/g,"").slice(0,6)),required:!0})})]}),e.jsx(l,{type:"submit","data-testid":"button-verify-code",className:"w-full",disabled:p.length!==6,children:"Continue"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full",onClick:()=>m("email"),children:"Back"})]}),x==="create"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),j.mutate({...s,verificationCode:p})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(n,{id:"register-username","data-testid":"input-register-username",placeholder:"Choose username",className:"pl-10 bg-muted border-border text-foreground",value:s.username,onChange:t=>g({...s,username:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(n,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Create password",className:"pl-10 bg-muted border-border text-foreground",value:s.password,onChange:t=>g({...s,password:t.target.value}),required:!0})]})]}),e.jsx(l,{type:"submit","data-testid":"button-register",className:"w-full",disabled:j.isPending,children:j.isPending?"Creating account...":"Create Account"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full",onClick:()=>m("verify"),children:"Back"})]})]})]})})]})]})})}export{ee as default};
