import{c as U,b as Y,d as H,r as o,j as e}from"./index-DVfgMWEj.js";import{u as m}from"./useMutation-C3JFyC0q.js";import{C as K,b as W,c as _,d as z,a as G}from"./card-MvFnLkI3.js";import{B as l}from"./button-CGxMIv-i.js";import{I as i}from"./input-DAqZUuE3.js";import{L as n}from"./label-C9xXS7C4.js";import{T as $,a as Q,b as R,c as q}from"./tabs-92imS97Q.js";import{D as X,d as Z,a as ee,b as se,c as te}from"./dialog-BNZCZsQ1.js";import{u as ae}from"./useTranslation-BN2bxvhs.js";import{S as re}from"./shield-DY8F3r7s.js";import{U as D}from"./Combination-CBNXuibq.js";import{L as A}from"./lock-D4ff3qnC.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ie=U("mail",oe);function be(){const{t:ne}=ae(),[,P]=Y(),{toast:a}=H(),[c,p]=o.useState({username:"",password:"",twoFactorToken:""}),[d,h]=o.useState({username:"",email:"",password:""}),[x,M]=o.useState(""),[f,u]=o.useState("email"),[I,J]=o.useState(!1),[V,F]=o.useState("email"),[w,k]=o.useState(""),[j,E]=o.useState(""),[g,T]=o.useState(""),[b,L]=o.useState(""),[B,O]=o.useState(!1),N=m({mutationFn:async s=>{const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await t.json();if(!t.ok)throw new Error(r.message);return r},onSuccess:s=>{if(s.requiresTwoFactor){J(!0),a({title:"2FA Required",description:"Please enter your authenticator code"});return}localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),a({title:"Welcome back!",description:`Logged in as ${s.user.username}`}),P("/")},onError:s=>{a({variant:"destructive",title:"Login Failed",description:s.message})}}),v=m({mutationFn:async s=>{const t=await fetch("/api/auth/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),r=await t.json();if(!t.ok)throw new Error(r.message);return r},onSuccess:()=>{a({title:"Code Sent",description:"Check your email for the verification code"}),u("verify")},onError:s=>{a({variant:"destructive",title:"Failed",description:s.message})}}),y=m({mutationFn:async s=>{const t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await t.json();if(!t.ok)throw new Error(r.message);return r},onSuccess:s=>{localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),a({title:"Account Created!",description:"Welcome to KYC Marketplace"}),P("/")},onError:s=>{a({variant:"destructive",title:"Registration Failed",description:s.message})}}),C=m({mutationFn:async s=>{const t=await fetch("/api/auth/request-password-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),r=await t.json();if(!t.ok)throw new Error(r.message);return r},onSuccess:()=>{a({title:"Check Email",description:"Password reset code sent to your email"}),F("reset")},onError:s=>{a({variant:"destructive",title:"Failed",description:s.message})}}),S=m({mutationFn:async()=>{if(g!==b)throw new Error("Passwords do not match");const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:j,newPassword:g})}),t=await s.json();if(!s.ok)throw new Error(t.message);return t},onSuccess:()=>{a({title:"Success!",description:"Password reset successfully. You can now login."}),O(!1),F("email"),k(""),E(""),T(""),L("")},onError:s=>{a({variant:"destructive",title:"Failed",description:s.message})}});return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-3 sm:p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-primary rounded-xl",children:e.jsx(re,{className:"h-7 sm:h-8 w-7 sm:w-8 text-primary-foreground"})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:"KYC Marketplace"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-2",children:"Secure peer-to-peer trading"})]}),e.jsxs(K,{className:"border-border bg-card/50 backdrop-blur",children:[e.jsxs(W,{children:[e.jsx(_,{className:"text-foreground",children:"Get Started"}),e.jsx(z,{children:"Sign in or create an account to start trading"})]}),e.jsx(G,{children:e.jsxs($,{defaultValue:"login",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(R,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(R,{value:"register","data-testid":"tab-register",children:"Register"})]}),e.jsx(q,{value:"login",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),N.mutate(c)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"login-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"login-username","data-testid":"input-login-username",placeholder:"Enter username",className:"pl-10 bg-muted border-border text-foreground",value:c.username,onChange:s=>p({...c,username:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"login-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:"Enter password",className:"pl-10 bg-muted border-border text-foreground",value:c.password,onChange:s=>p({...c,password:s.target.value})})]})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"2fa-token",className:"text-foreground",children:"2FA Code"}),e.jsx(i,{id:"2fa-token","data-testid":"input-2fa-token",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:c.twoFactorToken,onChange:s=>p({...c,twoFactorToken:s.target.value})})]}),e.jsx(l,{type:"submit","data-testid":"button-login",className:"w-full",disabled:N.isPending,children:N.isPending?"Signing in...":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsxs(X,{open:B,onOpenChange:O,children:[e.jsx(Z,{asChild:!0,children:e.jsx(l,{variant:"link",className:"text-sm p-0","data-testid":"button-forgot-password",children:"Forgot Password?"})}),e.jsxs(ee,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(te,{className:"text-foreground",children:"Reset Password"})}),V==="email"?e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email address and we'll send you a code to reset your password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"forgot-email",className:"text-foreground",children:"Email Address"}),e.jsx(i,{id:"forgot-email",type:"email",placeholder:"Enter your email",className:"bg-muted border-border",value:w,onChange:s=>k(s.target.value),"data-testid":"input-forgot-password-email"})]}),e.jsx(l,{className:"w-full",onClick:()=>C.mutate(w),disabled:!w||C.isPending,"data-testid":"button-send-reset-code",children:C.isPending?"Sending...":"Send Reset Code"})]}):e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the reset code from your email and your new password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"reset-code",className:"text-foreground",children:"Reset Code"}),e.jsx(i,{id:"reset-code",placeholder:"Enter reset code",className:"bg-muted border-border",value:j,onChange:s=>E(s.target.value),"data-testid":"input-reset-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"new-pwd",className:"text-foreground",children:"New Password"}),e.jsx(i,{id:"new-pwd",type:"password",placeholder:"Enter new password",className:"bg-muted border-border",value:g,onChange:s=>T(s.target.value),"data-testid":"input-reset-new-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"confirm-pwd",className:"text-foreground",children:"Confirm Password"}),e.jsx(i,{id:"confirm-pwd",type:"password",placeholder:"Confirm new password",className:"bg-muted border-border",value:b,onChange:s=>L(s.target.value),"data-testid":"input-reset-confirm-password"})]}),e.jsx(l,{className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>S.mutate(),disabled:!j||!g||!b||S.isPending,"data-testid":"button-confirm-reset-password",children:S.isPending?"Resetting...":"Reset Password"})]})]})]})})]})}),e.jsxs(q,{value:"register",children:[f==="email"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),v.mutate(d.email)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"Enter your email",className:"pl-10 bg-muted border-border text-foreground",value:d.email,onChange:s=>h({...d,email:s.target.value}),required:!0})]})]}),e.jsx(l,{type:"submit","data-testid":"button-send-code",className:"w-full",disabled:v.isPending,children:v.isPending?"Sending...":"Send Verification Code"})]}),f==="verify"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),u("create")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the code sent to ",d.email]}),e.jsx("div",{className:"relative",children:e.jsx(i,{"data-testid":"input-verification-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:x,onChange:s=>M(s.target.value.replace(/\D/g,"").slice(0,6)),required:!0})})]}),e.jsx(l,{type:"submit","data-testid":"button-verify-code",className:"w-full",disabled:x.length!==6,children:"Continue"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full",onClick:()=>u("email"),children:"Back"})]}),f==="create"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y.mutate({...d,verificationCode:x})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-username","data-testid":"input-register-username",placeholder:"Choose username",className:"pl-10 bg-muted border-border text-foreground",value:d.username,onChange:s=>h({...d,username:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Create password",className:"pl-10 bg-muted border-border text-foreground",value:d.password,onChange:s=>h({...d,password:s.target.value}),required:!0})]})]}),e.jsx(l,{type:"submit","data-testid":"button-register",className:"w-full",disabled:y.isPending,children:y.isPending?"Creating account...":"Create Account"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full",onClick:()=>u("verify"),children:"Back"})]})]})]})})]})]})})}export{be as default};
